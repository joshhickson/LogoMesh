
```mermaid
graph LR
  %% === Top Level Grouping ===
  %% Grouping LM-Core, API/Demo, and Future systems for overall layout

  subgraph UserAndExternalSystems ["User Interaction & Future Systems"]
    direction TB
    User["User"]

    subgraph LM_API ["Phase 1: API & Demo Frontends"]
      direction TB
      style LM_API fill:#ADD8E6,stroke:#4682B4
      BackendAPI["API Server (Node.js/Express.js - TS)\nserver/"]
      ReactDemoUI["React Demo UI (JS/JSX, Cytoscape.js)\nsrc/"]
      NodeRED["Node-RED (JS Flows)\nLocal Automation"]
    end

    subgraph LM_EXTERNAL ["Future Systems & Interfaces (Conceptual for P1)"]
      direction TB
      style LM_EXTERNAL fill:#E0E0E0,stroke:#808080
      SentienceShell_Ext["SentienceShell (LM-HI)\nFuture Plugin Suite"]
      MatrixCore_Ext["MatrixCore (VR/AR)\nFuture Plugin (C#/Unity)"]
      GraphDB_Ext["Graph Database (Memgraph - Cypher)\nFuture via Adapter"]
      OtherPlugins_Ext["Other LM-Core Plugins\nFuture"]
      EchoMesh_Ext["EchoMesh (Decentralized Comms)\nFuture Integration"]
    end
  end

  subgraph LMCoreComplex ["Phase 1: LM-Core Implementation"]
    direction TB
    style LMCoreComplex fill:#FFDAB9,stroke:#F08080

    subgraph CONTRACTS ["@contracts (TypeScript Interfaces)"]
      direction LR
      Entities["entities.ts\n(Thought, Segment, Tag, Task, etc.)"]
      LLMExecutorInterface["llmExecutor.ts"]
      StorageAdapterInterface["storageAdapter.ts"]
      GraphStorageAdapterInterface["graphStorageAdapter.ts (Stub)"]
      PluginAPIInterface["plugins/pluginApi.ts"]
      ThoughtExportProviderInterface["thoughtExportProvider.ts"]
      EventPayloads["events/payloads.ts"]
      EmbeddingInterface_Contract["embeddings/embeddingInterface.ts\n(Stubbed)"]
      ULSConfig_Contract["embeddings/ulsConfig.ts\n(Stubbed)"]
      AdapterRegistry_Contract["embeddings/adapterRegistry.ts\n(Stubbed)"]
    end

    subgraph CORE_SERVICES ["@core/services (TypeScript)"]
      direction TB
      IdeaMgr["IdeaManager"]
      MeshGraphEngine["MeshGraphEngine (Stubbed Ops)"]
      TaskEngine["TaskEngine (Mock Exec)"]
      PluginHost["PluginHost (Static Reg)"]
      EventBus["EventBus (In-Memory)"]
      PortabilitySvc["PortabilityService"]
      CognitiveContextEngine_Core["CognitiveContextEngine\n(Planned)"]
    end

    subgraph CORE_AI_ORCH ["@core/llm (TypeScript)"]
      direction TB
      LLMTaskRunner["LLMTaskRunner"]
      MockLLMExecutor["MockLLMExecutor.ts"]
      OllamaExecutorStub["OllamaExecutor.ts (Stub)"]
      MermaidAuditorStub["utils/mermaidAuditor.ts (Stub)"]
    end

    subgraph CORE_EMBEDDINGS ["@core/embeddings (TypeScript)"]
      direction TB
      VectorTranslationCore_Core["VectorTranslationCore\n(Stubbed)"]
    end

    subgraph CORE_STORAGE ["@core/storage (TypeScript)"]
      direction TB
      SQLiteAdapter["sqliteAdapter.ts"]
      MockGraphAdapter["graph/mocks/MockGraphAdapter.ts (Stub)"]
    end

    subgraph CORE_STATE_UTILS_LOGGING ["@core/state, utils, logger (TypeScript)"]
      direction LR
      ContextStateSvc["state/contextStateService.ts"]
      ExecStateSvc["state/executionStateService.ts (Stubbed)"]
      IDUtils["utils/idUtils.ts"]
      CoreLogger["utils/logger.ts"]
      LLMAuditLogger["logger/llmAuditLogger.ts"]
    end

    subgraph CORE_DB ["@core/db (SQL, TypeScript)"]
      direction LR
      SchemaSQL["schema.sql"]
      InitDB["initDb.ts"]
    end
  end

  %% Data Store (Separate for clarity)
  SQLite_DB_File["SQLite DB File\n(logomesh.sqlite3 - SQL)"]
  style SQLite_DB_File fill:#FFFFE0,stroke:#BDB76B

  %% === Connections ===

  %% User to UI
  User --> ReactDemoUI

  %% API/Demo Interactions with LM-Core
  BackendAPI -- Uses Services from --> CORE_SERVICES
  BackendAPI -- Uses Core Embeddings (for VTC) --> CORE_EMBEDDINGS
  ReactDemoUI -- HTTP Calls --> BackendAPI
  NodeRED -- HTTP Calls/Listens --> BackendAPI

  %% LM-Core Internal Connections
  CORE_SERVICES --> CONTRACTS
  CORE_AI_ORCH --> CONTRACTS
  CORE_EMBEDDINGS --> CONTRACTS
  CORE_STORAGE --> CONTRACTS

  IdeaMgr --> StorageAdapterInterface
  IdeaMgr --> EventBus
  IdeaMgr --> IDUtils
  IdeaMgr --> CoreLogger
  MeshGraphEngine --> IdeaMgr
  MeshGraphEngine --> GraphStorageAdapterInterface
  MeshGraphEngine -- Relies on (for context gen) --> CognitiveContextEngine_Core
  TaskEngine --> EventBus
  TaskEngine --> LLMTaskRunner
  PluginHost --> PluginAPIInterface
  PluginHost --> EventBus
  PortabilitySvc --> IdeaMgr
  CognitiveContextEngine_Core --> ThoughtExportProviderInterface
  CognitiveContextEngine_Core --> IdeaMgr
  CognitiveContextEngine_Core --> MeshGraphEngine
  CognitiveContextEngine_Core --> ContextStateSvc
  CognitiveContextEngine_Core --> LLMTaskRunner
  CognitiveContextEngine_Core --> VectorTranslationCore_Core
  LLMTaskRunner --> LLMExecutorInterface
  LLMTaskRunner --> LLMAuditLogger
  LLMTaskRunner --> VectorTranslationCore_Core
  VectorTranslationCore_Core --> EmbeddingInterface_Contract
  VectorTranslationCore_Core --> ULSConfig_Contract
  VectorTranslationCore_Core --> AdapterRegistry_Contract
  ContextStateSvc --> EventBus
  ExecStateSvc --> EventBus

  %% Adapter Implementations
  SQLiteAdapter --> StorageAdapterInterface
  SQLiteAdapter --> SQLite_DB_File

  MockGraphAdapter --> GraphStorageAdapterInterface

  %% DB Initialization
  InitDB --> SchemaSQL
  InitDB --> SQLite_DB_File

  %% Future System Interfaces (dashed lines indicating "will interface with")
  SentienceShell_Ext -.-> EventBus
  SentienceShell_Ext -.-> TaskEngine
  SentienceShell_Ext -.-> PluginAPIInterface
  SentienceShell_Ext -.-> CognitiveContextEngine_Core
  SentienceShell_Ext -.-> VectorTranslationCore_Core
  MatrixCore_Ext -.-> ThoughtExportProviderInterface
  MatrixCore_Ext -.-> EventBus
  MatrixCore_Ext -.-> VectorTranslationCore_Core
  GraphDB_Ext -.-> GraphStorageAdapterInterface
  OtherPlugins_Ext -.-> PluginHost
  OtherPlugins_Ext -.-> CognitiveContextEngine_Core
  OtherPlugins_Ext -.-> VectorTranslationCore_Core
  EchoMesh_Ext -.-> PortabilitySvc
  EchoMesh_Ext -.-> EventBus
  EchoMesh_Ext -.-> VectorTranslationCore_Core
  User -.-> SentienceShell_Ext
  User -.-> MatrixCore_Ext


  %% Styling (ensure these are valid and on separate lines)
  classDef LMCoreStyle fill:#FFDAB9,stroke:#F08080,color:#000000
  classDef LMAPIDemoStyle fill:#ADD8E6,stroke:#4682B4,color:#000000
  classDef LMFutureStyle fill:#E0E0E0,stroke:#808080,color:#333333
  classDef DBStyle fill:#FFFFE0,stroke:#BDB76B,color:#000000

  class LMCoreComplex LMCoreStyle
  class LM_API LMAPIDemoStyle
  class LM_EXTERNAL LMFutureStyle
  class SQLite_DB_File DBStyle
  ```
  