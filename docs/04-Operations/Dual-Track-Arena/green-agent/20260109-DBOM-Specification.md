---
status: ACTIVE
type: Spec
created: 2026-01-09
context: Green Agent Safety & Compliance
---

# Decision Bill of Materials (DBOM) Specification

## Overview
The **Decision Bill of Materials (DBOM)** is a cryptographic artifact generated by the Green Agent for every evaluation. It serves as an immutable record of the "Judge's Decision," providing a verifiable link between the **Intent** (what was asked) and the **Outcome** (the score).

This specification implements the "Cryptographic Proofs" requirement for the research paper.

## DBOM Structure
The DBOM is a JSON object containing the following fields:

| Field | Type | Description |
| :--- | :--- | :--- |
| `dbom_version` | String | Schema version (currently "1.0"). |
| `battle_id` | String | Unique identifier for the evaluation session. |
| `h_delta` | String | **Hash of the Delta.** SHA256 hash of the full evaluation result (JSON). |
| `v_intent` | List[Float] | **Intent Vector.** The raw embedding vector of the task description. |
| `score_cis` | Float | The final Contextual Integrity Score. |
| `sigma_judge` | String | **Judge's Signature.** A simulated cryptographic signature verifying the Green Agent authorized this score. |
| `timestamp` | String | ISO 8601 timestamp of generation. |

## Implementation Details

### Hashing (`h_delta`)
The system uses SHA256 to hash the raw JSON result of the battle. This ensures that any tampering with the score or the breakdown in the database can be detected by re-hashing the raw data.

```python
# src/green_logic/agent.py
h_delta = hashlib.sha256(raw_result.encode()).hexdigest()
```

### Intent Vector (`v_intent`)
The DBOM captures the **Intent Vector** (generated by the CIS Vector Math module) rather than just the text. This allows for future audits to mathematically verify if the scoring logic was consistent with the intent, without needing to re-run the embedding model.

### Signature (`sigma_judge`)
*   **Current State:** Simulated (`SIG_GREEN_{battle_id}_{h_delta[:8]}`).
*   **Future State:** This will be replaced by a real RSA or ECDSA signature signed by the Green Agent's private key.

## Storage
*   **File Path:** `data/dboms/dbom_{battle_id}.json`
*   **Database Link:** The `h_delta` is also stored in the primary `battles` database table to link the relational record with the cryptographic artifact.

## Usage in Research
These DBOMs provide the "proof of work" for the Contextual Debt paper. They allow us to assert that our benchmark scores are backed by:
1.  **Traceability:** We know exactly what task produced the score.
2.  **Integrity:** We can prove the result hasn't changed since generation.
3.  **Reproducibility:** The `v_intent` allows us to analyze the semantic spread of our test cases.
